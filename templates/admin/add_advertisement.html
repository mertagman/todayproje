<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Today Proje Gayrimenkul Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .content-wrapper {
            padding: 30px 0;
        }
        .edit-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
        }
        .edit-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 25px;
        }
        .edit-header h1 {
            color: #333;
            font-weight: 600;
            margin: 0;
        }
        .form-section {
            margin-bottom: 30px;
        }
        .form-section h5 {
            color: #495057;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f8f9fa;
        }
        .premade-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .premade-section h5 {
            color: #495057;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .radio-option {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .radio-option:hover {
            border-color: #667eea;
        }
        .radio-option.selected {
            border-color: #667eea;
            background-color: #f0f4ff;
        }
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin-top: 10px;
        }
        .btn-save {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
        }
        .btn-cancel {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-shield-alt me-2"></i>
                Today Proje Admin
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('admin_logout') }}">
                    <i class="fas fa-sign-out-alt me-1"></i>Çıkış Yap
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="content-wrapper">
        <div class="container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'info' }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="edit-card">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Anasayfaya Dön
                    </a>
                </div>
                <div class="edit-header">
                    <h1><i class="fas fa-plus me-2"></i>Yeni İlan Ekle</h1>
                    <p class="text-muted mb-0">Add new advertisement</p>
                </div>

                <!-- Premade Templates Section -->
                <div class="premade-section">
                    <h5><i class="fas fa-template me-2"></i>Hazır Şablonlar</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="radio-option" data-template="emin">
                                <input type="radio" name="template_choice" value="emin" id="template_emin" class="form-check-input me-2">
                                <label for="template_emin" class="form-check-label">
                                    <strong>Emin</strong><br>
                                    <small class="text-muted">Devremülk - Armutlu, Yalova</small>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="radio-option" data-template="yalova">
                                <input type="radio" name="template_choice" value="yalova" id="template_yalova" class="form-check-input me-2">
                                <label for="template_yalova" class="form-check-label">
                                    <strong>Yalova Terma City</strong><br>
                                    <small class="text-muted">Devremülk - Yalova</small>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="radio-option" data-template="other">
                                <input type="radio" name="template_choice" value="other" id="template_other" class="form-check-input me-2" checked>
                                <label for="template_other" class="form-check-label">
                                    <strong>Diğer</strong><br>
                                    <small class="text-muted">Manuel giriş</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <form method="POST" enctype="multipart/form-data">
                    <!-- Hidden fields for premade image paths -->
                    <input type="hidden" name="img_1_path" id="img_1_path">
                    <input type="hidden" name="img_2_path" id="img_2_path">
                    <input type="hidden" name="img_3_path" id="img_3_path">

                    <!-- Basic Information -->
                    <div class="form-section">
                        <h5><i class="fas fa-info-circle me-2"></i>Temel Bilgiler</h5>
                        
                        <div class="mb-3">
                            <label for="title" class="form-label">Başlık *</label>
                            <input type="text" class="form-control" id="title" name="title" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="advertisement_type" class="form-label">İlan Tipi</label>
                            <select class="form-select" id="advertisement_type" name="advertisement_type" required>
                                <option value="devremülk">Devremülk</option>
                                <option value="arsa">Arsa</option>
                                <option value="konut">Konut</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="adres" class="form-label">Adres</label>
                            <input type="text" class="form-control" id="adres" name="adres" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contract_id" class="form-label">Sözleşme No</label>
                            <input type="text" class="form-control" id="contract_id" name="contract_id" required>
                        </div>
                    </div>

                    <!-- Property Details -->
                    <div class="form-section">
                        <h5><i class="fas fa-home me-2"></i>Özellikler</h5>
                        
                        <div class="mb-3">
                            <label for="bed_type" class="form-label">Oda Tipi</label>
                            <input type="text" class="form-control" id="bed_type" name="bed_type" placeholder="örn: 3+1">
                        </div>
                        
                        <div class="mb-3">
                            <label for="deed" class="form-label">Tapu Tipi</label>
                            <select class="form-select" id="deed" name="deed" required>
                                <option value="var">Var</option>
                                <option value="yok">Yok</option>
                            </select>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="is_gold" name="is_gold">
                            <label class="form-check-label" for="is_gold">
                                <i class="fas fa-star text-warning"></i> Gold İlan
                            </label>
                        </div>
                    </div>

                    <!-- Pricing -->
                    <div class="form-section">
                        <h5><i class="fas fa-dollar-sign me-2"></i>Fiyatlar</h5>
                        
                        <div class="mb-3">
                            <label for="sale_price" class="form-label">Satış Fiyatı</label>
                            <div class="input-group">
                                <span class="input-group-text">₺</span>
                                <input type="text" class="form-control price-input" id="sale_price" name="sale_price" placeholder="5.950.000" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="rent_price" class="form-label">Kira Fiyatı</label>
                            <div class="input-group">
                                <span class="input-group-text">₺</span>
                                <input type="text" class="form-control price-input" id="rent_price" name="rent_price" placeholder="15.000" required>
                            </div>
                        </div>
                    </div>

                    <!-- Images -->
                    <div class="form-section">
                        <h5><i class="fas fa-images me-2"></i>Resimler</h5>
                        
                        <div class="mb-3">
                            <label for="img_1" class="form-label">Resim 1</label>
                            <input type="file" class="form-control" id="img_1" name="img_1" accept="image/*">
                            <div id="img_1_preview_container" class="mt-2" style="display: none;">
                                <small class="text-muted">Şablon resmi:</small>
                                <img id="img_1_preview" class="image-preview" alt="Preview">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="img_2" class="form-label">Resim 2</label>
                            <input type="file" class="form-control" id="img_2" name="img_2" accept="image/*">
                            <div id="img_2_preview_container" class="mt-2" style="display: none;">
                                <small class="text-muted">Şablon resmi:</small>
                                <img id="img_2_preview" class="image-preview" alt="Preview">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="img_3" class="form-label">Resim 3</label>
                            <input type="file" class="form-control" id="img_3" name="img_3" accept="image/*">
                            <div id="img_3_preview_container" class="mt-2" style="display: none;">
                                <small class="text-muted">Şablon resmi:</small>
                                <img id="img_3_preview" class="image-preview" alt="Preview">
                            </div>
                        </div>
                    </div>

                    <!-- Descriptions -->
                    <div class="form-section">
                        <h5><i class="fas fa-align-left me-2"></i>Açıklamalar</h5>
                        <div class="mb-3">
                            <label for="description" class="form-label">Açıklama (Türkçe)</label>
                            <textarea class="form-control" id="description" name="description" rows="4"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="description_en" class="form-label">Açıklama (İngilizce)</label>
                            <textarea class="form-control" id="description_en" name="description_en" rows="4"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="description_ar" class="form-label">Açıklama (Arapça)</label>
                            <textarea class="form-control" id="description_ar" name="description_ar" rows="4"></textarea>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary btn-save">
                            <i class="fas fa-save me-2"></i>İlan Ekle
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Premade templates data
        const templates = {
            emin: {
                title: "Emin Termal",
                advertisement_type: "devremülk",
                adres: "Zafer caddesi 60. Sokak Karşıyaka Mahallesi Armutlu, Yalova",
                img_1_path: "/devremulk/emin.jpg",
                img_2_path: "/devremulk/emin2.jpg",
                img_3_path: "/devremulk/emin3.jpeg",
                description: "Kendine ait mutfak bölümü bulunan evlerde uydu yayınlı LCD TV, ücretsiz Wi-Fi, klima, balkon, mutfak gereçleri ve elektronik anahtar sistemi yer alıyor. Ayrıca yine tümü özel banyolu olan birimler; banyo malzemeleri, saç kurutma makinesi, banyo havluları ve bornoz ile donatılmış durumda.",
                description_en: "Houses with their own kitchen area include satellite TV, LCD TV, free Wi-Fi, air conditioning, a balcony, kitchen utensils, and an electronic key system. Additionally, all units with private bathrooms are equipped with toiletries, a hairdryer, bath towels, and a bathrobe.",
                description_ar: "تحتوي المنازل على قسم مطبخ خاص بها وتلفزيون LCD مع قنوات فضائية وخدمة الواي فاي المجانية وتكييف وشرفة ومطبخ"
            },
            yalova: {
                title: "Yalova Terma City",
                advertisement_type: "devremülk",
                adres: "Akköy Köyü Ayrım Sokak No:5/1 Termal Yalova",
                img_1_path: "/devremulk/yalova1.jpg",
                img_2_path: "/devremulk/yalova2.jpg",
                img_3_path: "/devremulk/yalova3.jpg",
                description: "Tarlaların çevrelediği bir bölgede yer alan bu lüks otel, Marmara Denizi'ndeki en yakın plaja 6 km ve E 881 Avrupa yoluna 10 km uzaklıktadır. Rahat mobilyalarla döşenmiş odalarda düz ekran TV, ücretsiz WiFi ve mini bar vardır. 1-4 yatak odalı dairelerde ayrı oturma odası mevcuttur. Dairelerin çoğunda mobilyalı balkon bulunur. Açık hava bölümü bulunan rahat bir restoran mevcuttur. Diğer olanaklar arasında teraslı ve şezlonglu açık yüzme havuzu, jakuzi, spor salonu, sauna ve güzellik salonu yer alır. Egzersiz dersleri ve spor sahalarından da yararlanılabilir.",
                description_en: "This luxury hotel, located in an area surrounded by fields, is 6 km from the nearest beach on the Sea of Marmara and 10 km from the E 881 European road. The rooms, furnished with comfortable furniture, come with a flat-screen TV, free Wi-Fi, and a minibar. The 1-4 bedroom apartments feature a separate living area, and most of the apartments have a furnished balcony. There is a relaxed restaurant with an outdoor section. Other amenities include a terrace with sun loungers, an outdoor swimming pool, a jacuzzi, a gym, a sauna, and a beauty salon. Exercise classes and sports facilities are also available.",
                description_ar: "يقع هذا الفندق الفاخر في منطقة تحيط بها الحقول، على بعد ٦ كم من أقرب شاطئ على بحر مرمرة."
            },
            other: {
                title: "",
                advertisement_type: "devremülk",
                adres: "",
                img_1_path: "",
                img_2_path: "",
                img_3_path: "",
                description: "",
                description_en: "",
                description_ar: ""
            }
        };

        // Handle template selection
        document.querySelectorAll('input[name="template_choice"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const template = templates[this.value];
                
                // Update visual selection
                document.querySelectorAll('.radio-option').forEach(option => {
                    option.classList.remove('selected');
                });
                this.closest('.radio-option').classList.add('selected');
                
                // Fill form fields
                document.getElementById('title').value = template.title;
                document.getElementById('advertisement_type').value = template.advertisement_type;
                document.getElementById('adres').value = template.adres;
                document.getElementById('description').value = template.description;
                document.getElementById('description_en').value = template.description_en;
                document.getElementById('description_ar').value = template.description_ar;
                
                // Set hidden image paths
                document.getElementById('img_1_path').value = template.img_1_path;
                document.getElementById('img_2_path').value = template.img_2_path;
                document.getElementById('img_3_path').value = template.img_3_path;
                
                // Show/hide image previews
                for (let i = 1; i <= 3; i++) {
                    const container = document.getElementById(`img_${i}_preview_container`);
                    const preview = document.getElementById(`img_${i}_preview`);
                    
                    if (template[`img_${i}_path`]) {
                        preview.src = template[`img_${i}_path`];
                        container.style.display = 'block';
                    } else {
                        container.style.display = 'none';
                    }
                }
            });
        });

        // Handle radio option clicks
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
                radio.dispatchEvent(new Event('change'));
            });
        });

        // Initialize with "other" template selected
        document.getElementById('template_other').dispatchEvent(new Event('change'));

        // Price formatting functionality
        function formatPrice(value) {
            // Remove all non-digit characters
            const cleanValue = value.replace(/\D/g, '');
            if (cleanValue === '') return '';
            
            // Add dots for thousands separator
            return cleanValue.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function unformatPrice(value) {
            // Remove dots to get clean number
            return value.replace(/\./g, '');
        }

        // Add price formatting to all price inputs
        document.querySelectorAll('.price-input').forEach(input => {
            input.addEventListener('input', function() {
                const cursorPosition = this.selectionStart;
                const oldLength = this.value.length;
                
                this.value = formatPrice(this.value);
                
                // Adjust cursor position after formatting
                const newLength = this.value.length;
                const newCursorPosition = cursorPosition + (newLength - oldLength);
                this.setSelectionRange(newCursorPosition, newCursorPosition);
            });

            // Store unformatted value in a hidden field before form submission
            input.addEventListener('blur', function() {
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = this.name + '_raw';
                hiddenInput.value = unformatPrice(this.value);
                
                // Remove existing hidden input if any
                const existingHidden = document.querySelector(`input[name="${this.name}_raw"]`);
                if (existingHidden) {
                    existingHidden.remove();
                }
                
                this.parentNode.appendChild(hiddenInput);
            });
        });

        // Image preview functionality for file uploads
        document.querySelectorAll('input[type="file"]').forEach(input => {
            if (input.name.startsWith('img_')) {
                input.addEventListener('change', function() {
                    const existingPreview = this.parentNode.querySelector('.new-image-preview');
                    if (existingPreview) {
                        existingPreview.remove();
                    }
                    
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'image-preview new-image-preview';
                            img.alt = 'New Image Preview';
                            input.parentNode.appendChild(img);
                        };
                        reader.readAsDataURL(this.files[0]);
                    }
                });
            }
        });
    </script>
</body>
</html>
